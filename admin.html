<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Partner - Admin Panel</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #6366f1;
            --primary-hover: #4f46e5;
            --bg-body: #f1f5f9;
            --card-bg: rgba(255, 255, 255, 0.9);
            --text-main: #1e293b;
            --text-muted: #64748b;
            --border-color: #e2e8f0;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', system-ui, -apple-system, sans-serif; }

        body { background: var(--bg-body); color: var(--text-main); line-height: 1.5; }

        .glass { background: var(--card-bg); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.3); }

        .admin-layout { display: grid; grid-template-columns: 260px 1fr; min-height: 100vh; }

        .sidebar { background: #1e293b; color: white; padding: 2rem 1.5rem; position: sticky; top: 0; height: 100vh; display: flex; flex-direction: column; }
        .sidebar-logo { font-size: 1.5rem; font-weight: 800; margin-bottom: 2.5rem; display: flex; align-items: center; gap: 10px; color: #818cf8; }
        .nav-item { padding: 0.75rem 1rem; border-radius: 12px; margin-bottom: 0.5rem; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 12px; color: #94a3b8; text-decoration: none; border: none; background: none; width: 100%; text-align: left; font-size: 0.95rem; }
        .nav-item:hover, .nav-item.active { background: rgba(255,255,255,0.1); color: white; }
        .nav-item i { width: 20px; text-align: center; }

        .main-content { padding: 2rem; overflow-y: auto; }
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2.5rem; }
        .page-title { font-size: 1.5rem; font-weight: 700; }

        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2.5rem; }
        .stat-card { padding: 1.5rem; border-radius: 20px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); background: white; }
        .stat-card .label { color: var(--text-muted); font-size: 0.875rem; font-weight: 500; margin-bottom: 0.5rem; }
        .stat-card .value { font-size: 1.5rem; font-weight: 700; color: var(--text-main); }
        .stat-card .icon { float: right; padding: 10px; border-radius: 10px; }

        .content-card { background: white; border-radius: 24px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.05); padding: 1.5rem; }
        
        .user-table { width: 100%; border-collapse: separate; border-spacing: 0 8px; margin-top: 1rem; }
        .user-table th { padding: 1rem; text-align: left; color: var(--text-muted); font-weight: 600; text-transform: uppercase; font-size: 0.7rem; border-bottom: 1px solid var(--border-color); }
        .user-table tr { transition: transform 0.2s; }
        .user-table td { padding: 1rem; background: white; border-top: 1px solid var(--border-color); border-bottom: 1px solid var(--border-color); }
        .user-table td:first-child { border-left: 1px solid var(--border-color); border-top-left-radius: 12px; border-bottom-left-radius: 12px; }
        .user-table td:last-child { border-right: 1px solid var(--border-color); border-top-right-radius: 12px; border-bottom-right-radius: 12px; }

        .btn-primary { background: var(--primary); color: white; border: none; padding: 0.75rem 1.25rem; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .btn-primary:hover { background: var(--primary-hover); transform: translateY(-1px); }
        
        .badge { padding: 4px 10px; border-radius: 8px; font-size: 0.7rem; font-weight: 700; text-transform: uppercase; }
        .badge-free { background: #f1f5f9; color: #64748b; }
        .badge-premium { background: #fffbeb; color: #d97706; }
        .badge-vip { background: #f5f3ff; color: #7c3aed; }

        .search-container { position: relative; margin-bottom: 1.5rem; }
        .search-container i { position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--text-muted); }
        .search-bar { width: 100%; padding: 0.75rem 1rem 0.75rem 2.5rem; border: 1px solid var(--border-color); border-radius: 12px; outline: none; font-size: 0.9rem; }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); backdrop-filter: blur(4px); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .modal-content { background: white; padding: 2rem; border-radius: 24px; width: 95%; max-width: 500px; position: relative; max-height: 90vh; overflow-y: auto; border: none; }

        .action-btn { cursor: pointer; color: var(--danger); border: 1px solid #fee2e2; background: #fff; padding: 6px; border-radius: 8px; transition: all 0.2s; }
        .action-btn:hover { background: #fee2e2; }
        .edit-btn { cursor: pointer; color: var(--primary); border: 1px solid #dbeafe; background: #fff; padding: 6px; border-radius: 8px; transition: all 0.2s; }
        .edit-btn:hover { background: #dbeafe; }
        .premium-btn { cursor: pointer; color: var(--warning); border: 1px solid #fef3c7; background: #fff; padding: 6px; border-radius: 8px; transition: all 0.2s; }
        .premium-btn:hover { background: #fef3c7; }

        .hidden { display: none !important; }

        @media (max-width: 1024px) {
            .admin-layout { grid-template-columns: 1fr; }
            .sidebar { display: none; }
        }
    </style>
</head>
<body style="background: var(--bg-body);">
    <div id="adminLogin" class="login-box" style="max-width: 400px; margin: 100px auto; padding: 40px; background: white; border-radius: 32px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.1); text-align: center;">
        <div style="font-size: 1.5rem; font-weight: 800; color: var(--primary); margin-bottom: 2rem; display: flex; align-items: center; justify-content: center; gap: 10px;">
            <i class="fas fa-heart"></i> Partner Admin
        </div>
        <h2 style="margin-bottom: 10px; font-weight: 700;">Welcome Back</h2>
        <p style="color: var(--text-muted); margin-bottom: 30px; font-size: 0.9rem;">Login to manage your community</p>
        <div style="text-align: left; margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.85rem;">Password</label>
            <input type="password" id="adminPassword" placeholder="••••••••" style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 10px; outline: none;">
        </div>
        <button onclick="loginAdmin()" class="btn-primary" style="width: 100%;">Login to Dashboard</button>
        <p id="loginMsg" style="color: var(--danger); margin-top: 15px; font-size: 0.85rem; font-weight: 500;"></p>
    </div>

    <div id="adminDashboard" class="admin-layout hidden">
        <aside class="sidebar">
            <div class="sidebar-logo">
                <i class="fas fa-heart"></i> Partner
            </div>
            <nav style="flex: 1;">
                <button class="nav-item active"><i class="fas fa-users"></i> Users</button>
                <button class="nav-item"><i class="fas fa-credit-card"></i> Payments</button>
                <button class="nav-item"><i class="fas fa-chart-line"></i> Stats</button>
            </nav>
            <button onclick="logoutAdmin()" class="nav-item" style="margin-top: auto;">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </aside>

        <main class="main-content">
            <header class="top-bar">
                <div>
                    <h1 class="page-title">User Management</h1>
                    <p style="color: var(--text-muted); font-size: 0.85rem;">Manage and monitor platform users</p>
                </div>
                <button class="btn-primary" style="background: white; color: var(--text-main); border: 1px solid var(--border-color);" onclick="loadUsers()">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </header>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="icon" style="background: #e0e7ff; color: var(--primary);"><i class="fas fa-users"></i></div>
                    <div class="label">Total Users</div>
                    <div class="value" id="totalUsers">0</div>
                </div>
                <div class="stat-card">
                    <div class="icon" style="background: #fef3c7; color: var(--warning);"><i class="fas fa-crown"></i></div>
                    <div class="label">Premium</div>
                    <div class="value" id="totalPremium">0</div>
                </div>
                <div class="stat-card">
                    <div class="icon" style="background: #d1fae5; color: var(--success);"><i class="fas fa-receipt"></i></div>
                    <div class="label">Total Txns</div>
                    <div class="value" id="totalPayments">0</div>
                </div>
                <div class="stat-card">
                    <div class="icon" style="background: #fee2e2; color: var(--danger);"><i class="fas fa-exclamation-circle"></i></div>
                    <div class="label">Pending</div>
                    <div class="value" id="pendingVerify">0</div>
                </div>
            </div>

            <div class="content-card">
                <div class="search-container">
                    <i class="fas fa-search"></i>
                    <input type="text" id="userSearch" class="search-bar" placeholder="Search users..." onkeyup="filterUsers()">
                </div>

                <div style="overflow-x: auto;">
                    <table class="user-table">
                        <thead>
                            <tr>
                                <th>Picture</th>
                                <th>Name & ID</th>
                                <th>Contact Info</th>
                                <th>Identity</th>
                                <th>Premium Mgmt</th>
                                <th>Payments</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="userList"></tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- Payment Modal -->
    <div id="paymentModal" class="modal-overlay hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000;">
        <div class="modal-content" style="background: white; padding: 25px; border-radius: 15px; width: 90%; max-width: 400px; position: relative;">
            <button onclick="closePaymentModal()" style="position: absolute; right: 15px; top: 15px; border: none; background: none; font-size: 20px; cursor: pointer;">&times;</button>
            <h2 style="margin-bottom: 20px;">Add Payment Record</h2>
            <input type="hidden" id="payUserId">
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px;">Amount (BDT)</label>
                <input type="number" id="payAmount" placeholder="e.g. 500" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
            </div>
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 5px;">Transaction ID</label>
                <input type="text" id="payTrxId" placeholder="e.g. BKX123456" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
            </div>
            <button onclick="savePayment()" class="btn-primary" style="width: 100%;">Save Payment</button>
        </div>
    </div>

    <!-- Edit Info Modal -->
    <div id="editInfoModal" class="modal-overlay hidden">
        <div class="modal-content">
            <button onclick="closeEditModal()" style="position: absolute; right: 15px; top: 15px; border: none; background: none; font-size: 20px; cursor: pointer; color: var(--text-muted);">&times;</button>
            <h2 style="margin-bottom: 20px; color: var(--text-main);">Edit User Profile</h2>
            <input type="hidden" id="editUserId">
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.85rem; color: var(--text-muted);">Name</label>
                <input type="text" id="editName" style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 10px; outline: none;">
            </div>

            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.85rem; color: var(--text-muted);">Mobile</label>
                <input type="text" id="editMobile" style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 10px; outline: none;">
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.85rem; color: var(--text-muted);">Age</label>
                    <input type="number" id="editAge" style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 10px; outline: none;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.85rem; color: var(--text-muted);">Gender</label>
                    <select id="editGender" style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 10px; outline: none;">
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.85rem; color: var(--text-muted);">Location</label>
                    <input type="text" id="editLocation" style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 10px; outline: none;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.85rem; color: var(--text-muted);">Relationship Status</label>
                    <select id="editStatus" style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 10px; outline: none;">
                        <option value="Single">Single</option>
                        <option value="অবিবাহিত">অবিবাহিত</option>
                        <option value="Divorced">Divorced</option>
                        <option value="Widowed">Widowed</option>
                        <option value="Separated">Separated</option>
                    </select>
                </div>
            </div>

            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.85rem; color: var(--text-muted);">Education</label>
                <input type="text" id="editEducation" style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 10px; outline: none;">
            </div>

            <div style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.85rem; color: var(--text-muted);">About / Bio</label>
                <textarea id="editAbout" rows="3" style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 10px; outline: none; resize: vertical;"></textarea>
            </div>

            <button onclick="saveFullInfo()" class="btn-primary" style="width: 100%; padding: 14px;">Update User Information</button>
        </div>
    </div>

    <script>
        async function loginAdmin() {
            const pass = document.getElementById('adminPassword').value;
            const formData = new FormData();
            formData.append('action', 'login');
            formData.append('password', pass);

            const res = await fetch('admin_api.php', { method: 'POST', body: formData });
            const data = await res.json();
            if (data.success) {
                showDashboard();
            } else {
                document.getElementById('loginMsg').textContent = data.message;
            }
        }

        async function showDashboard() {
            document.getElementById('adminLogin').classList.add('hidden');
            document.getElementById('adminDashboard').classList.remove('hidden');
            loadUsers();
        }

        async function loadUsers() {
            const res = await fetch('admin_api.php?action=get_users', {
                headers: { 'Cache-Control': 'no-cache' }
            });
            const data = await res.json();
            if (data.success) {
                const list = document.getElementById('userList');
                list.innerHTML = '';
                let premium = 0;
                let pending = 0;
                let totalPayments = 0;
                
                window.allUsers = data.users; // Store globally for filtering

                data.users.forEach(u => {
                    if (u.subscription && u.subscription !== 'free') premium++;
                    
                    let hasPending = false;
                    (u.payments || []).forEach(p => {
                        totalPayments++;
                        if (p.status === 'pending') {
                            pending++;
                            hasPending = true;
                        }
                    });

                    const row = document.createElement('tr');
                    const photo = u.profile_pic ? u.profile_pic : `https://ui-avatars.com/api/?name=${encodeURIComponent(u.name)}`;
                    const planBadge = u.subscription ? `badge-${u.subscription.toLowerCase()}` : 'badge-free';
                    
                    row.innerHTML = `
                        <td><img src="${photo}" style="width: 48px; height: 48px; border-radius: 12px; object-fit: cover; border: 2px solid #f1f5f9;"></td>
                        <td>
                            <div style="font-weight: 600; color: #1e293b;">${u.name}</div>
                            <div style="font-size: 0.75rem; color: #64748b;">ID: ${u.id}</div>
                        </td>
                        <td>
                            <div style="color: #475569; font-weight: 500;">${u.mobile}</div>
                            <div style="font-size: 0.75rem; color: #94a3b8;">${u.email || 'No email'}</div>
                        </td>
                        <td>
                            <span class="badge" style="background: #f1f5f9; color: #475569;">${u.gender}</span>
                        </td>
                        <td>
                            <span class="badge ${planBadge}">${u.subscription || 'free'}</span>
                            <div class="mt-1 flex space-x-1" style="display: flex; gap: 4px; margin-top: 4px;">
                                <button onclick="togglePremium('${u.id}', 'free')" class="text-[10px]" style="font-size: 10px; color: #64748b; border: none; background: none; cursor: pointer;">Free</button>
                                <button onclick="togglePremium('${u.id}', 'premium')" class="text-[10px]" style="font-size: 10px; color: #6366f1; border: none; background: none; cursor: pointer;">Prem</button>
                                <button onclick="togglePremium('${u.id}', 'vip')" class="text-[10px]" style="font-size: 10px; color: #7c3aed; border: none; background: none; cursor: pointer;">VIP</button>
                            </div>
                        </td>
                        <td style="font-size: 0.85em; min-width: 250px;">
                            <div id="payments_${u.id}">
                                ${(u.payments || []).map(p => `
                                    <div style="border: 1px solid #f1f5f9; padding: 8px; border-radius: 8px; margin-bottom: 5px; background: ${p.status === 'pending' ? '#fffbeb' : '#f8fafc'};">
                                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                            <div>
                                                <strong style="color: #0f172a;">${p.amount}৳</strong>
                                                <div style="font-family: monospace; font-size: 0.7rem; color: #64748b; margin-top: 2px;">${p.trx_id}</div>
                                            </div>
                                            <div style="display: flex; gap: 5px;">
                                                ${p.status === 'pending' ? `
                                                    <button onclick="verifyPayment('${u.id}', '${p.trx_id}')" class="btn-small" style="background: #10b981; color: white; border: none; padding: 4px 8px; border-radius: 6px; font-size: 10px; cursor: pointer; font-weight: 600;">Verify</button>
                                                ` : `
                                                    <span style="color: #10b981; font-size: 12px;"><i class="fas fa-check-circle"></i></span>
                                                `}
                                                <button onclick="deletePayment('${u.id}', '${p.trx_id}')" class="btn-small" style="background: #ef4444; color: white; border: none; padding: 4px 8px; border-radius: 6px; font-size: 10px; cursor: pointer;"><i class="fas fa-trash"></i></button>
                                            </div>
                                        </div>
                                        <div style="font-size: 0.65rem; color: #94a3b8; margin-top: 4px;">${p.date || ''}</div>
                                    </div>
                                `).join('')}
                                <button onclick="openPaymentModal('${u.id}')" style="width: 100%; padding: 8px; border: 1px dashed #cbd5e1; border-radius: 8px; background: #f8fafc; color: #64748b; font-size: 0.75rem; cursor: pointer; font-weight: 500; transition: all 0.2s;">+ Add Record</button>
                            </div>
                        </td>
                        <td>
                            <div style="display: flex; gap: 8px;">
                                <button onclick="editFullInfo('${u.id}')" class="edit-btn" style="color: #6366f1; border-color: #e0e7ff;" title="Edit Profile"><i class="fas fa-edit"></i></button>
                                <button onclick="resetPassword('${u.id}')" class="edit-btn" style="color: #f59e0b; border-color: #fef3c7;" title="Reset Password"><i class="fas fa-key"></i></button>
                                <button onclick="deleteUser('${u.id}')" class="action-btn" title="Delete User"><i class="fas fa-trash"></i></button>
                            </div>
                        </td>
                    `;
                    list.appendChild(row);
                });
                document.getElementById('totalUsers').textContent = data.users.length;
                document.getElementById('totalPremium').textContent = premium;
                document.getElementById('totalPayments').textContent = totalPayments;
                document.getElementById('pendingVerify').textContent = pending;
            }
        }

        function filterUsers() {
            const query = document.getElementById('userSearch').value.toLowerCase();
            const rows = document.getElementById('userList').getElementsByTagName('tr');
            
            for (let row of rows) {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(query) ? '' : 'none';
            }
        }

        async function togglePremium(id, plan) {
            const formData = new FormData();
            formData.append('action', 'toggle_premium');
            formData.append('user_id', id);
            formData.append('plan', plan);

            const res = await fetch('admin_api.php', { method: 'POST', body: formData });
            const data = await res.json();
            if (data.success) {
                loadUsers();
            }
        }

        async function verifyPayment(userId, trxId) {
            const plan = prompt('Enter subscription plan to grant (free/premium/vip):', 'premium');
            if (!plan) return;
            
            const formData = new FormData();
            formData.append('action', 'verify_payment');
            formData.append('user_id', userId);
            formData.append('trx_id', trxId);
            formData.append('plan', plan.toLowerCase());

            const res = await fetch('admin_api.php', { method: 'POST', body: formData });
            const data = await res.json();
            if (data.success) {
                loadUsers();
            }
        }

        async function deletePayment(userId, trxId) {
            if (!confirm('Are you sure you want to delete this payment record?')) return;
            
            const formData = new FormData();
            formData.append('action', 'delete_payment');
            formData.append('user_id', userId);
            formData.append('trx_id', trxId);

            const res = await fetch('admin_api.php', { method: 'POST', body: formData });
            const data = await res.json();
            if (data.success) {
                loadUsers();
            }
        }

        async function deleteUser(id) {
            if (confirm('Are you sure? This cannot be undone.')) {
                const formData = new FormData();
                formData.append('action', 'delete_user');
                formData.append('user_id', id);
                await fetch('admin_api.php', { method: 'POST', body: formData });
                loadUsers();
            }
        }

        async function resetPassword(id) {
            const newPassword = prompt('Enter new password for this user:');
            if (!newPassword) return;
            
            const formData = new FormData();
            formData.append('action', 'change_password');
            formData.append('user_id', id);
            formData.append('password', newPassword);
            
            const res = await fetch('admin_api.php', { method: 'POST', body: formData });
            const data = await res.json();
            if (data.success) {
                alert('Password reset successfully');
            } else {
                alert('Failed to reset password: ' + data.message);
            }
        }

        function openPaymentModal(id) {
            document.getElementById('payUserId').value = id;
            document.getElementById('paymentModal').classList.remove('hidden');
        }

        function closePaymentModal() {
            document.getElementById('paymentModal').classList.add('hidden');
        }

        async function savePayment() {
            const id = document.getElementById('payUserId').value;
            const amount = document.getElementById('payAmount').value;
            const trxId = document.getElementById('payTrxId').value;
            
            if (!amount || !trxId) return alert('Fill all fields');
            
            const formData = new FormData();
            formData.append('action', 'add_payment_admin');
            formData.append('user_id', id);
            formData.append('amount', amount);
            formData.append('trx_id', trxId);
            
            const res = await fetch('admin_api.php', { method: 'POST', body: formData });
            const data = await res.json();
            if (data.success) {
                closePaymentModal();
                loadUsers();
            }
        }

        async function editFullInfo(id) {
            const u = window.allUsers.find(user => user.id === id);
            if (!u) return;
            
            document.getElementById('editUserId').value = id;
            document.getElementById('editName').value = u.name || '';
            document.getElementById('editMobile').value = u.mobile || '';
            document.getElementById('editAge').value = u.age || '';
            document.getElementById('editGender').value = (u.gender || 'male').toLowerCase();
            document.getElementById('editLocation').value = u.location || '';
            document.getElementById('editEducation').value = u.education || '';
            document.getElementById('editStatus').value = u.status || 'Single';
            document.getElementById('editAbout').value = u.about || '';
            
            const modal = document.getElementById('editInfoModal');
            modal.classList.remove('hidden');
            modal.style.display = 'flex';
        }

        async function saveFullInfo() {
            const id = document.getElementById('editUserId').value;
            const formData = new FormData();
            formData.append('action', 'update_user_full_info');
            formData.append('user_id', id);
            formData.append('name', document.getElementById('editName').value);
            formData.append('mobile', document.getElementById('editMobile').value);
            formData.append('age', document.getElementById('editAge').value);
            formData.append('gender', document.getElementById('editGender').value);
            formData.append('location', document.getElementById('editLocation').value);
            formData.append('education', document.getElementById('editEducation').value);
            formData.append('status', document.getElementById('editStatus').value);
            formData.append('about', document.getElementById('editAbout').value);

            const res = await fetch('admin_api.php', { method: 'POST', body: formData });
            const result = await res.json();
            if (result.success) {
                closeEditModal();
                loadUsers();
            } else {
                alert(result.message);
            }
        }

        function closeEditModal() {
            const modal = document.getElementById('editInfoModal');
            modal.classList.add('hidden');
            modal.style.display = 'none';
        }

        function logoutAdmin() {
            fetch('admin_api.php', {
                method: 'POST',
                body: new URLSearchParams({ action: 'logout' })
            }).then(() => {
                location.reload();
            });
        }
    </script>
</body>
</html>